<div class="sessions-container p-4">
  <div class="flex justify-between items-center mb-4">
    <div>
      <h2 class="text-3xl font-bold text-white">Sessions</h2>
      <p class="text-gray-400 text-sm">View and manage your farming sessions</p>
    </div>
    <div class="flex items-center gap-4">
      @if (playerName) {
        <div class="text-gray-400">
          Current player: <span class="text-primary font-bold">{{ playerName }}</span>
        </div>
      }
      <p-select
        [(ngModel)]="selectedPlayerFilter"
        (onChange)="onPlayerFilterChange()"
        [options]="players"
        optionLabel="label"
        optionValue="value"
        placeholder="Filter by Player"
        [showClear]="false"
        [loading]="loadingPlayers"
        appendTo="body"
        [style]="{'min-width': '200px'}"
      ></p-select>
    </div>
  </div>

  <p-dataview
    [value]="sessions"
    [loading]="loading"
    [paginator]="true"
    [rows]="pageSize"
    [totalRecords]="totalRecords"
    (onPage)="onPageChange($event)"
    [lazy]="true"
    layout="grid"
  >
    <ng-template #header>
      <div class="flex justify-between items-center">
        <div class="text-sm text-gray-400">
          Showing {{ sessions.length }} of {{ totalRecords }} sessions
        </div>
      </div>
    </ng-template>

    <ng-template #grid let-items>
      <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4 gap-4">
        <div *ngFor="let session of items"  (click)="openSessionDetails(session)">
          <p-card styleClass="bg-surface-800 border-surface-700 session-card" class="session-card-wrapper cursor-pointer">
            <ng-template #content>
              <div class="space-y-3 relative">

                <!-- Session Header -->
                <div class="flex items-center justify-between">
                  <h3 class="text-base font-semibold text-white">{{ session.title }}</h3>
                </div>

                <!-- Session Info -->
                <div class="text-xs text-gray-400 space-y-1">
                  <div class="flex items-center gap-1">
                    <i class="pi pi-user text-xs"></i>
                    <span>{{ session.player_name }}</span>
                  </div>
                  <div class="flex items-center gap-1">
                    <i class="pi pi-calendar text-xs"></i>
                    <span>{{ formatDate(session.started_at) }}</span>
                  </div>
                  <div class="flex items-center gap-1">
                    @if (session.is_active) {
                      <span class="inline-flex items-center gap-1 px-2 py-0.5 rounded text-xs font-semibold bg-green-900 text-green-300 border border-green-700">
                        <i class="pi pi-circle-fill text-[8px]"></i>
                        Active
                      </span>
                    } @else if (session.ended_at) {
                      <i class="pi pi-clock text-xs"></i>
                      <span>{{ getSessionDuration(session) | duration }}</span>
                    }
                  </div>
                </div>

                @if (session.description) {
                  <p class="text-gray-500 text-xs">{{ session.description }}</p>
                }

                <!-- Separator -->
                <div class="border-t border-surface-600"></div>

                <!-- Session Stats - Text Format -->
                <div class="space-y-2 text-sm">
                  <div class="flex justify-between items-center">
                    <span class="text-gray-400">Total Maps:</span>
                    <span class="text-blue-400 font-semibold">{{ session.total_maps }}</span>
                  </div>
                  <div class="flex justify-between items-center">
                    <span class="text-gray-400">Total Currency:</span>
                    <span class="font-semibold" [ngClass]="getCurrencyClass(session.total_currency_delta)">
                      {{ session.total_currency_delta | currency }}
                    </span>
                  </div>
                  <div class="flex justify-between items-center">
                    <span class="text-gray-400">Currency / {{ periodicUnitShort === 'h' ? 'Hour' : 'Minute' }}:</span>
                    <span class="text-yellow-400 font-semibold">{{ session.currency_per_hour | currency:true }}</span>
                  </div>
                </div>


              </div>

            </ng-template>

              <!-- Magnifying Glass Icon - Shows on Hover -->
              <div class="magnifying-glass-overlay"></div>
          </p-card>
        </div>
      </div>
    </ng-template>
  </p-dataview>
  
  <app-session-details
    [visible]="detailsDialogVisible"
    (visibleChange)="detailsDialogVisible = $event"
    [sessionDetails]="sessionDetails"
    [sessionTitle]="selectedSessionTitle"
  ></app-session-details>
</div>
